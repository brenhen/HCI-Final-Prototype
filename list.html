<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Grocery Route Planner - List</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="phone-frame">
    <header class="app-header">
      <a href="index.html" class="nav-link">Home</a>
      <h1 class="app-title">Grocery List</h1>
      <span></span>
    </header>

    <main class="list-main">
      <div class="badge">
        Store: City Market - Downtown
      </div>

      <!-- favorites section from past trips -->
      <section class="favorites-section">
        <div class="favorites-title">Favorites (from past trips)</div>
        <p class="favorites-hint">
          Tap an item to quickly add it to your list.
        </p>
        <div class="favorites-list">
          <button type="button" class="favorite-pill">Milk</button>
          <button type="button" class="favorite-pill">Eggs</button>
          <button type="button" class="favorite-pill">Coffee</button>
          <button type="button" class="favorite-pill">Ground Beef</button>
        </div>
      </section>

      <h2 class="screen-title list-title">Add Grocery Items</h2>

      <!-- add/search form -->
      <form class="inline-form" onsubmit="return false;">
        <input id="item-input" class="input" type="text" placeholder="Add or search item…">
        <button id="add-button" type="button">Add</button>
      </form>

      <!-- dairy category -->
      <section class="category">
        <div class="category-header">Dairy</div>
        <div id="dairy-items">
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="milk">
              <label for="milk">Butter</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="yogurt">
              <label for="yogurt">Yogurt</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="eggs">
              <label for="eggs">Cheese</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
        </div>
      </section>

      <!-- produce category -->
      <section class="category">
        <div class="category-header">Produce</div>
        <div id="produce-items">
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="carrots">
              <label for="carrots">Carrots</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="tomatoes">
              <label for="tomatoes">Tomatoes</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
        </div>
      </section>

      <!-- meat category -->
      <section class="category">
        <div class="category-header">Meat</div>
        <div id="meat-items">
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="chicken">
              <label for="chicken">Chicken</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
        </div>
      </section>

      <!-- pantry category -->
      <section class="category">
        <div class="category-header">Pantry</div>
        <div id="pantry-items">
          <div class="item-row">
            <div class="item-left">
              <input type="checkbox" id="pasta">
              <label for="pasta">Pasta</label>
            </div>
            <button class="item-delete" type="button">✕</button>
          </div>
        </div>
      </section>

      <p class="list-helper">
        Delete items by tapping the x button next to them.
      </p>

      <a href="map.html">
        <button class="primary-btn" type="button">
          Next - Map preview
        </button>
      </a>
    </main>
  </div>

  <!-- custom error prevention message instead of window alert -->
<div id="modal" class="modal hidden">
  <div class="modal-content">
    <p id="modal-message"></p>

    <div class="modal-buttons">
      <button id="modal-cancel" class="modal-btn cancel-btn">Cancel</button>
      <button id="modal-confirm" class="modal-btn confirm-btn">OK</button>
    </div>
  </div>
</div>
</body>


  <!-- JS to handle add, x, favorites, error prevention, and duplicates -->
  <script>
document.addEventListener('DOMContentLoaded', function () {

  /* system popup for duplicate and delete handling */
  const modal = document.getElementById('modal');
  const modalMessage = document.getElementById('modal-message');
  const modalCancel = document.getElementById('modal-cancel');
  const modalConfirm = document.getElementById('modal-confirm');

  let modalResolve = null;

  function showModal(message) {
    modalMessage.textContent = message;
    modal.classList.remove('hidden');

    return new Promise((resolve) => {
      modalResolve = resolve;
    });
  }

  modalCancel.addEventListener('click', () => {
    modal.classList.add('hidden');
    if (modalResolve) modalResolve(false);
  });

  modalConfirm.addEventListener('click', () => {
    modal.classList.add('hidden');
    if (modalResolve) modalResolve(true);
  });


  /* elements refs */
  const input = document.getElementById('item-input');
  const addButton = document.getElementById('add-button');

  const dairyContainer = document.getElementById('dairy-items');
  const produceContainer = document.getElementById('produce-items');
  const meatContainer = document.getElementById('meat-items');
  const pantryContainer = document.getElementById('pantry-items');

  const allContainers = [dairyContainer, produceContainer, meatContainer, pantryContainer];


  /* check duplicates */
  function itemExists(name) {
    const lower = name.toLowerCase();
    return allContainers.some(container =>
      [...container.querySelectorAll('label')].some(l => l.textContent.toLowerCase() === lower)
    );
  }


  /* create new row for item */
  function addItemToCategory(name, container) {
    if (itemExists(name)) {
      showModal(`"${name}" is already on your list.`);  
      return;
    }

    const id = 'item-' + name.toLowerCase().replace(/\s+/g, '-');

    const row = document.createElement('div');
    row.className = 'item-row';
    row.innerHTML = `
      <div class="item-left">
        <input type="checkbox" id="${id}">
        <label for="${id}">${name}</label>
      </div>
      <button class="item-delete" type="button">✕</button>
    `;

    container.appendChild(row);

    const deleteBtn = row.querySelector('.item-delete');
    attachDeleteHandler(deleteBtn);
  }


  /* delete with popup to confirm */
  function attachDeleteHandler(button) {
    button.addEventListener('click', async function () {
      const row = button.closest('.item-row');
      if (!row) return;

      const name = row.querySelector('label').textContent;

      const confirmed = await showModal(`Remove "${name}" from your list?`);
      if (confirmed) row.remove();
    });
  }


  /* add delete hadnlers */
  document.querySelectorAll('.item-delete').forEach(attachDeleteHandler);


  /* add button */
  addButton.addEventListener('click', function () {
    const itemName = input.value.trim();
    if (itemName === '') return;

    let target = pantryContainer;

    const lower = itemName.toLowerCase();
    if (lower.includes('milk') || lower.includes('yogurt') || lower.includes('cheese') || lower.includes('eggs')) {
      target = dairyContainer;
    } else if (lower.includes('carrot') || lower.includes('tomato')) {
      target = produceContainer;
    } else if (lower.includes('beef') || lower.includes('chicken')) {
      target = meatContainer;
    }

    addItemToCategory(itemName, target);
    input.value = '';
  });


  /* favorites */
  document.querySelectorAll('.favorite-pill').forEach(pill => {
    pill.addEventListener('click', function () {
      const name = pill.textContent.trim().toLowerCase();
      let target = pantryContainer;

      if (name === 'milk' || name === 'eggs') {
        target = dairyContainer;
      } else if (name === 'ground beef' || name === 'chicken') {
        target = meatContainer;
      } else if (name === 'coffee') {
        target = pantryContainer;
      }

      addItemToCategory(pill.textContent.trim(), target);
    });
  });

});
</script>
</html>
